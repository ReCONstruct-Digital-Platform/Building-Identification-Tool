{% extends 'buildings/base.html' %}

{% block content %}
{% load humanize %}

{{ building_latest_view_data | json_script:"building_latest_view_data" }}

<script src="{% static 'scripts/map.js' %}"></script>
<script>
    var map;
    var sv;
    var m_marker;
    var sv_marker;

    var panoRequest;
    var building_coord;


    function initMaps() {
      const svService = new google.maps.StreetViewService();

      // If we have already seen the building, get the latest user defined view
      const building_latest_view_data = JSON.parse(document.getElementById('building_latest_view_data').textContent);

      if (building_latest_view_data) {
        panoRequest = {
          pano: building_latest_view_data['sv_pano']
        };

        building_coord = {
          lat: building_latest_view_data['marker_lat'],
          lng: building_latest_view_data['marker_lng']
        };
      }
      // No preivously saved view data
      // we will search for best panorama
      else {
        building_coord = {
          lat: parseFloat("{{ building.lat }}"),
          lng: parseFloat("{{ building.lon }}")
        };

        panoRequest = {
          location: building_coord,
          preference: google.maps.StreetViewPreference.BEST,
          radius: 50,
          source: google.maps.StreetViewSource.OUTDOOR
        };
      }

      function findPanoramaByRadius(panoRequest, building_coord) {

        console.log(`Searching using radius`);

        svService.getPanorama(panoRequest, function(panoData, status) {
          if (status === google.maps.StreetViewStatus.OK) {

            console.log("Found Panorama")
            // Calculate the correct direction the camera must face
            // based on the panorama default location and the building location
            const heading = google.maps.geometry.spherical.computeHeading(panoData.location.latLng, building_coord);

            sv = new google.maps.StreetViewPanorama(
              document.getElementById('streetview'),
              {
                  position: building_coord,
                  center: building_coord,
                  zoom: 0,
                  pov: {
                    heading: heading,
                    pitch: 0,
                  },
              });

              sv_marker = new google.maps.Marker({
                position: building_coord,
                map: sv,
                title: "Building",
                draggable: true,
              });

              sv_marker.addListener("dragend", ()=> {
                m_marker.setPosition(sv_marker.getPosition());
              })

              // Setting the panorama after the marker has been defined,
              // otherwise the marker does not show for some reason!
              // https://stackoverflow.com/questions/23498921/google-street-view-with-custom-panorama-and-markers
              sv.setPano(panoData.location.pano);
              window.sv = sv;

              map = new google.maps.Map(document.getElementById("satmap"), {
                center: building_coord,
                mapTypeId: 'satellite',
                zoom: 18,
                // streetViewControl: false,
                rotateControl: false,
                controlSize: 25,
              });

              m_marker = new google.maps.Marker({
                position: building_coord,
                map: map,
                draggable: true,
              });

              map.setStreetView(sv);
              window.map = map;

              // Listen to the marker being dragged and update the one on the streetview to match
              m_marker.addListener("dragend", ()=> {
                sv_marker.setPosition(m_marker.getPosition());
              })
          }
          else {
            var radius = panoRequest.radius
            //Handle other statuses here
            if (radius > 200) {
              console.log(`Could not find a street view within ${radius}m of building! Giving up.`);
              elem = document.createElement('div');
              elem.innerText = "Could not find Panorama for location";
              document.getElementById("streetview").appendChild(elem);
              return False;
            }
            else {
              console.log(`Could not find street view within ${radius}m, trying again within ${radius+50}m.`)
              panoRequest.radius = panoRequest.radius + 50;
              findPanoramaByRadius(panoRequest, building_coord);
            }
          }
        });
        }

      function findPanoramaById(panoRequest, building_coord) {
        console.log(`Searching for panorama using Id: ${panoRequest.pano}`);

        svService.getPanorama(panoRequest, function(panoData, status) {
          if (status === google.maps.StreetViewStatus.OK) {

            const heading = building_latest_view_data['sv_heading'];
            const zoom = building_latest_view_data['sv_zoom'];
            const pitch = building_latest_view_data['sv_pitch'];

            sv = new google.maps.StreetViewPanorama(
              document.getElementById('streetview'),
              {
                  position: building_coord,
                  center: building_coord,
                  zoom: zoom,
                  pov: {
                    heading: heading,
                    pitch: pitch,
                  },
              });

              sv_marker = new google.maps.Marker({
                position: building_coord,
                map: sv,
                title: "Building",
                draggable: true,
              });

              sv_marker.addListener("dragend", ()=> {
                m_marker.setPosition(sv_marker.getPosition());
              })

              // Setting the panorama after the marker has been defined,
              // otherwise the marker does not show for some reason!
              // https://stackoverflow.com/questions/23498921/google-street-view-with-custom-panorama-and-markers
              sv.setPano(panoData.location.pano);
              window.sv = sv;

              map = new google.maps.Map(document.getElementById("satmap"), {
                center: building_coord,
                mapTypeId: 'satellite',
                zoom: 18,
                // streetViewControl: false,
                rotateControl: false,
                controlSize: 25,
              });

              m_marker = new google.maps.Marker({
                position: building_coord,
                map: map,
                draggable: true,
              });

              map.setStreetView(sv);
              window.map = map;

              // Listen to the marker being dragged and update the one on the streetview to match
              m_marker.addListener("dragend", ()=> {
                sv_marker.setPosition(m_marker.getPosition());
              })
          }
          else {
            console.log(`Could not find panorama id ${panoRequest.pano}. Searching using radius`);
            // Making a radius search request
            panoRequest = {
              location: building_coord,
              preference: google.maps.StreetViewPreference.BEST,
              radius: 50,
              source: google.maps.StreetViewSource.OUTDOOR
            };
            return findPanoramaByRadius(panoRequest, building_coord);
          }
        });
      }

      if (building_latest_view_data)
        findPanoramaById(panoRequest, building_coord);
        else
        findPanoramaByRadius(panoRequest, building_coord);
    }

    window.initMaps = initMaps;
</script>

<section class="container-wide mb-3">
  <div class="classify-top-row">
    <div class="building-nav building-nav-left">
      <a id="prev-building-link">&laquo;&laquo; Prev</a>
    </div>
    <div class="building-info">

      <div class="building-info-col">
        <div class="building-id">
          <h4>
            Building #{{ building.id }}
          </h4>
        </div>
        <div>
          {{ building.formatted_address }}
        </div>
        <div class="building-cubf">
          CUBF {{ building.cubf }}: {{ building.cubf_name }}
        </div>
      </div>
      <div class="building-info-col ml-5">
        <div>
          Const. year:
          {% if building.construction_year != 9999 %}
            {{ building.construction_year }}
            {% if building.year_real_esti == 'E' %}
            (Est.)
            {% endif %}
          {% else %}
          &mdash;
          {% endif %}
        </div>
        <div>
          Max floors:
          {% if building.max_num_floor %}
          {{ building.max_num_floor }}
          {% else %}
          &mdash;
          {% endif %}
        </div>
        <div>
          Floor area:
          {% if building.floor_area != 9999.0 %}
          {{ building.floor_area }} m<sup>2</sup>
          {% else %}
          &mdash;
          {% endif %}
        </div>
      </div>

      <div class="building-info-col ml-5">
        <div>
          Type const.:
          {% if building.type_const %}

          {% include "buildings/utils/construction_type.html" with type_const=building.type_const %}

          {% else %}
          &mdash;
          {% endif %}
        </div>
        <div>
          Property value: ${{ building.value_prop|intcomma }}
        </div>
        <div>
          Non-res premises:
          {% if building.num_non_res %}

          {{ building.num_non_res }}
          {% else %}
          &mdash;
          {% endif %}
        </div>
      </div>
      <button id="btn-no-building" type="button" class="btn btn-danger btn-no-building ml-5">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-triangle-fill" viewBox="0 0 16 16">
          <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
        </svg>
        No Building
      </button>
    </div>
    <div class="building-nav building-nav-right">
      <a id="next" href="{% url 'buildings:classify' next_building %}">Next &raquo;&raquo;</a>
    </div>
  </div>
</section>

<section class="container-wide">
  <div class="streetview-and-map-container">
    <div class="streetview-container ml-3">
      <div id="streetview"></div>
    </div>
    <div id="dragbar"></div>
    <div class="map-and-submit-container mr-3">

      <!--bootstrap script-->
      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

      <!--navigation bar-->
      <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
          <button class="nav-link active" id="nav-satellite-tab" data-bs-toggle="tab" data-bs-target="#nav-satellite" type="button" role="tab" aria-controls="nav-satellite" aria-selected="true" >Satellite</button>
          <button class="nav-link" id="nav-survey-tab" data-bs-toggle="tab" data-bs-target="#nav-survey" type="button" role="tab" aria-controls="nav-survey" aria-selected="false" onclick={TestsFunction()}>Survey</button>
        </div>
      </nav>

      <!--division: division of satellite image and survey questionnaires -->
      <div class="tab-content" id="nav-tabContent">
        <script>
          function TestsFunction() {
              console.log("123");
              var T = document.getElementById("nav-survey"),
                  displayValue = "";
                 console.log(T.style.display);
              if (T.style.display == "")
                T.style.display = "none";

              T.style.display = displayValue;
          }
        </script>
        <div class="tab-pane show map-container" id="nav-survey" role="tabpanel" aria-labelledby="nav-survey-tab"  style="display: none">
          <script>
            //calculate the height of text bar dynamically
            $(document).ready(function() {

              $('#streetview').bind('DOMSubtreeModified', function(){
                var dynheight = $('#streetview').height();
                console.log('changed dynHeight: ' + dynheight);
                var nav_tabheight = $('#nav-tab').height();
                var textHeight = dynheight - nav_tabheight ;

                window.onload = (function () {
                    document.getElementById("scroll").style.height = textHeight + "px";})();
              });
            });
          </script>

          <style>
          #scroll {
            overflow-y: scroll;
          }
          </style>

          <!--below is the first scrolling survey -->
          <div id="scroll">
            <div class="text-center">
              <p></p>
              <h5>
                <strong>Section 1: Three Mandatory Questions</strong>
              </h5>
            </div>
            <hr />

            <form >
              <!--Q1_Version3-->
              <style>
              .survey {
                  -webkit-column-count: 3; /* Chrome, Safari, Opera */
                  -moz-column-count: 3; /* Firefox */
                  column-count: 3;
                  padding-left: 50px;

              }

              .horizontal {
                  -webkit-column-count: 2; /* Chrome, Safari, Opera */
                  -moz-column-count: 2; /* Firefox */
                  column-count: 2;
                  padding-left: 50px;
                  display: flex;
              }


               .vertical_survey {
                  padding-left: 50px;
              }

              </style>
              <p class="text-center"><strong>Q1: What is the cladding material? (Select all that apply)</strong></p>
              <div class="survey" id="Q1">
                <span style="white-space: nowrap;"><input type="checkbox" name="Q1" value="Brick"  /> Brick</span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q1" value="Curtain_wall"  /> Curtain wall</span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q1" value="Vinyl" /> Vinyl </span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q1" value="Concrete"  /> Concrete</span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q1" value="Masonry"  /> Masonry</span><br/>
                <span style="white-space:nowrap;"><input type="checkbox" name="Q1" value="Wood"  /> Wood</span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q1" value="Ceramic"  /> Ceramic</span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q1" value="Metal" /> Metal </span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q1" value="Unsure" /> Unsure</span><br/>


              </div>
              <br>

              <p class="text-center"><strong>Q2: What kind of roof does the building have?</strong></p>
              <div class="survey" id="Q2">
                <span style="white-space: nowrap;"><input type="radio" name="Q2" value="Butterfly"  /> Butterfly</span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q2" value="Flat" /> Flat </span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q2" value="Hipped" /> Hipped </span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q2" value="Complex" /> Complex  </span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q2" value="Curved"  /> Curved</span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q2" value="Gabled"  /> Gabled</span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q2" value="Mansard" /> Mansard</span><br/>
                <span style="white-space:nowrap;"><input type="radio" name="Q2" value="Unsure"  /> Unsure </span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q2" value="Dormers"  /> Dormers</span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q2" value="Gambrel" /> Gambrel</span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q2" value="Single_Pitch"  /> Single Pitch</span><br/>


              </div>
              <br>

              <p class="text-center"><strong>Q3: What is the roofing material? (Select all that apply) </strong></p>
              <div class="survey" id="Q3">
                <span style="white-space: nowrap;"><input type="checkbox" name="Q3" value="Asphalt_Shingle" /> Asphalt Shingle</span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q3" value="Green_Roof" /> Green Roof </span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q3" value="Tar"  /> Tar</span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q3" value="Wood_Shake"  /> Wood Shake</span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q3" value="Concrete"  /> Concrete</span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q3" value="Metal"  /> Metal</span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q3" value="Tile" /> Tile</span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q3" value="Unsure"  /> Unsure</span><br/>
                <span style="white-space: nowrap;"><input type="checkbox" name="Q3" value="Gravel" /> Gravel</span><br/>
                <span style="white-space:nowrap;"><input type="checkbox" name="Q3" value="Slate"  /> Slate</span><br/>
              </div>

              <br>
              <div class="text-center">
              <p></p>
              <h5>
                <strong>Section 2: Building function (Mandatory)</strong>
              </h5>
            </div>
            <hr />

              <script>
                $(document).ready(function(){
                  $("input[name$='Q4']").click(function() {
                      var test = $(this).val();
                      if (test[2] == '1') {
                          // Check whether this is a top-level question, and if so,
                          // hide all the subquestions (and uncheck responses)
                          $('.desc').hide();
                          $('input').not('[value='+test+']').removeAttr('checked');
                      } else {
                          // Find the ID of this question
                          var parent_q = $($(this).parents('.desc')[0]).attr('id');
                          var type = parent_q.substring(0,2); // Get the type, such as "in"
                          var level = parent_q.substring(2);  // Get the level, such as 1
                          $(".desc").each(function(elt_index, elt) {
                              // Hide each question/answer with either a different type or a higher ID.
                              var e_id = $(elt).attr('id');
                              if(e_id.substring(0,2) != type || e_id.substring(2) > level) {
                                  $(elt).hide();
                                  $(elt).children('input').removeAttr('checked');
                              }
                          });
                      }
                      $("#"+test).show();
                  });
              });

              $(document).ready(function(){
                  $("input[name$='Q5']").click(function() {
                      var test = $(this).val();
                      if (test[2] == '1') {
                          // Check whether this is a top-level question, and if so,
                          // hide all the subquestions (and uncheck responses)
                          $('.desc2').hide();
                          $('input').not('[value='+test+']').removeAttr('checked');
                      } else {
                          // Find the ID of this question
                          var parent_q = $($(this).parents('.desc2')[0]).attr('id');
                          var type = parent_q.substring(0,2); // Get the type, such as "in"
                          var level = parent_q.substring(2);  // Get the level, such as 1
                          $(".desc2").each(function(elt_index, elt) {
                              // Hide each question/answer with either a different type or a higher ID.
                              var e_id = $(elt).attr('id');
                              if(e_id.substring(0,2) != type || e_id.substring(2) > level) {
                                  $(elt).hide();
                                  $(elt).children('input').removeAttr('checked');
                              }
                          });
                      }
                      $("#"+test).show();
                  });
              });

               $(document).ready(function(){
                  $("input[name$='Q7']").click(function() {
                      var test = $(this).val();
                      if (test[2] == '1') {
                          // Check whether this is a top-level question, and if so,
                          // hide all the subquestions (and uncheck responses)
                          $('.desc5').hide();
                          $('input').not('[value='+test+']').removeAttr('checked');
                      } else {
                          // Find the ID of this question
                          var parent_q = $($(this).parents('.desc5')[0]).attr('id');
                          var type = parent_q.substring(0,2); // Get the type, such as "in"
                          var level = parent_q.substring(2);  // Get the level, such as 1
                          $(".desc5").each(function(elt_index, elt) {
                              // Hide each question/answer with either a different type or a higher ID.
                              var e_id = $(elt).attr('id');
                              if(e_id.substring(0,2) != type || e_id.substring(2) > level) {
                                  $(elt).hide();
                                  $(elt).children('input').removeAttr('checked');
                              }
                          });
                      }
                      $("#"+test).show();
                  });
              });

              $(document).ready(function(){
                  $("input[name$='Q14']").click(function() {
                      var test = $(this).val();
                      if (test[2] == '1') {
                          // Check whether this is a top-level question, and if so,
                          // hide all the subquestions (and uncheck responses)
                          $('.desc3').hide();
                          $('input').not('[value='+test+']').removeAttr('checked');
                      } else {
                          // Find the ID of this question
                          var parent_q = $($(this).parents('.desc3')[0]).attr('id');
                          var type = parent_q.substring(0,2); // Get the type, such as "in"
                          var level = parent_q.substring(2);  // Get the level, such as 1
                          $(".desc3").each(function(elt_index, elt) {
                              // Hide each question/answer with either a different type or a higher ID.
                              var e_id = $(elt).attr('id');
                              if(e_id.substring(0,2) != type || e_id.substring(2) > level) {
                                  $(elt).hide();
                                  $(elt).children('input').removeAttr('checked');
                              }
                          });
                      }
                      $("#"+test).show();
                  });
              });

               $(document).ready(function(){
                  $("input[name$='Q18']").click(function() {
                      var test = $(this).val();
                      if (test[2] == '1') {
                          // Check whether this is a top-level question, and if so,
                          // hide all the subquestions (and uncheck responses)
                          $('.desc4').hide();
                          $('input').not('[value='+test+']').removeAttr('checked');
                      } else {
                          // Find the ID of this question
                          var parent_q = $($(this).parents('.desc4')[0]).attr('id');
                          var type = parent_q.substring(0,2); // Get the type, such as "in"
                          var level = parent_q.substring(2);  // Get the level, such as 1
                          $(".desc4").each(function(elt_index, elt) {
                              // Hide each question/answer with either a different type or a higher ID.
                              var e_id = $(elt).attr('id');
                              if(e_id.substring(0,2) != type || e_id.substring(2) > level) {
                                  $(elt).hide();
                                  $(elt).children('input').removeAttr('checked');
                              }
                          });
                      }
                      $("#"+test).show();
                  });
              });
              </script>
              <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.0.js"></script>
              <script type="text/javascript" src="script.js"></script>
              <style>
                   .desc { display: none; }
                   .desc2 { display: none; }
                   .desc3 { display: none; }
                   .desc4 { display: none; }
                   .desc5 { display: none; }
              </style>

              <div  class="vertical_survey"id="Q4">
              <p class="text-center"><strong>Q4: What is the building use?</strong></p>
                <span style="white-space: nowrap;"><input type="radio" name="Q4" value="SF1" /> Single-family detached</span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q4" value="SD1"  /> Semi-detached (Duplex) </span><br/>
                <span style="white-space:nowrap;"><input type="radio" name="Q4" value="MU1"  /> Multi-Residential building</span><br/>
                  <div id="MU1" class="desc vertical_survey">
                    <div><label><input type="radio" name="Q4_1" value="MU2"> Rowhouse (>3 dwellings) </label></div><br>
                    <div><label><input type="radio" name="Q4_1" value="MU3"> Large multi-family: MURB (apartments/flats/condos) </label></div><br>
                  </div>
                <span style="white-space: normal;"><input type="radio" name="Q4" value="PU1" /> Publicly owned, intended for community or collective use <br>(Community centre, recreation centre, sports facility, cultural centre, municipal depot, etc.)</span><br/>
                  <div id="PU1" class="desc vertical_survey">
                    <div><label><input type="radio" name="Q4_2" value="PU4"> Community center</label></div><br>
                    <div><label><input type="radio" name="Q4_2" value="PU3"> Hockey arena</label></div><br>
                    <div><label><input type="radio" name="Q4_2" value="PU5"> Library</label></div><br>
                    <div><label><input type="radio" name="Q4_2" value="PU2"> Sports/Recreation center (Various)</label></div><br>
                    <div><label><input type="radio" name="Q4_2" value="PU6"> Unsure</label></div><br>
                  </div>
                <span style="white-space: nowrap;"><input type="radio" name="Q4" value="SC1"  /> Schools</span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q4" value="OT1"  /> Other</span><br/>
              </div>


              <div class="btn-row">
                  <input style="display:none;" id="submit_Q4" class="btn btn-vote mr-5" type="submit" value="Submit">
              </div>

              <script>
                $("input[type='radio']").change(function(){
                  if($(this).val()=="SF1")
                  {
                      $("#submit_Q4").show();
                      $("#submit_Q4_1").hide();
                  }

                  else if ($(this).val()=="SD1")
                  {
                      $("#submit_Q4").show();
                      $("#submit_Q4_1").hide();
                  }

                  else
                  {
                         $("#submit_Q4").hide();
                         $("#submit_Q4_1").show();
                  }
                  });

              </script>

              <div id="submit_Q4_1">
              <div class="text-center">
              <p></p>
              <h5>
                <strong>Section 3: Age and Condition</strong>
              </h5>
            </div>
            <hr />

              <div  class="vertical_survey" id="Q5">
              <p class="text-center"><strong>Q5: Was this building built before 2000? </strong></p>
                <span style="white-space: nowrap;"><input type="radio" name="Q5" value="NO1" /> No</span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q5" value="YE1"  /> Yes OR Unsure</span><br/>
                <br>
                  <div id = "YE1" class="desc2 vertical_survey">
                    <p><strong>What condition does the building appear to be in?</strong></p>
                    <div><label><input type="radio" name="Q5_1" value="YE2"> Great condition (shallow retrofit)</label></div><br>
                    <div><label><input type="radio" name="Q5_1" value="YE3"> Medium condition (medium retrofit)</label></div><br>
                    <div><label><input type="radio" name="Q5_1" value="YE4"> Poor condition (deep retrofit) </label></div><br>
                    <br>
                    <div class = "another" id = "submit_Q5_2">
                    <p><strong>Does this building look recently renovated? </strong></p>
                    <div><label><input type="radio" name="Q5_2" value="YE5"> Yes </label></div><br>
                    <div><label><input type="radio" name="Q5_2" value="YE6"> No or Unsure </label></div><br>
                    </div>

                    <div class="btn-row">
                      <input style="display:none;" id="submit_Q5" class="btn btn-vote mr-5" type="submit" value="Submit">
                    </div>

                    <script>
                      $("input[type='radio']").change(function(){
                        if($(this).val()=="YE2")
                        {
                            $("#submit_Q5").show();
                            $("#submit_Q5_1").hide();
                            $("#submit_Q5_2").hide();

                        }
                        else
                        {
                               $("#submit_Q5").hide();
                               $("#submit_Q5_1").show();
                               $("#submit_Q5_2").show();
                        }
                        });
                    </script>
                  </div>
              </div>

              <div id = "submit_Q5_1">
              <div class="text-center">
              <p></p>
              <h5>
                <strong>Section 4: Mecahnicals and Geometry</strong>
              </h5>
            </div>
            <hr />
              <p class="text-center"><strong>Q6: What is the building footprint? </strong></p>
              <div class="vertical_survey" id="Q6">
                <span style="white-space: nowrap;"><input type="radio" name="Q6" value="Insignificant" /> Less than 300m2</span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q6" value="Small "  /> 300m2 to 600m2</span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q6" value="Medium" /> 600m2 to 2000m2</span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q6" value="Large"  /> More than 2000m2</span><br/>
              </div>
              <br>

                <div class="btn-row">
                  <input style="display:none;" id="submit_Q6" class="btn btn-vote mr-5" type="submit" value="Submit">
              </div>

              <script>
                $("input[type='radio']").change(function(){
                  if($(this).val()=="Insignificant")
                  {
                      $("#submit_Q6").show();
                      $("#submit_Q6_1").hide();

                  }
                  else
                  {
                         $("#submit_Q6").hide();
                         $("#submit_Q6_1").show();
                  }
                  });

              </script>

              <div id = "submit_Q6_1">
              <!--Q7-->
              <p class="text-center"><strong>Q7: How many storeys does the building have? </strong></p>
                <div class="vertical_survey" id="Q7">
                  <span style="white-space: nowrap;"><input type="radio" name="Q7" value="AC1" /> CUBF data is accurate</span><br/>
                  <span style="white-space:nowrap;"><input type="radio" name="Q7" value="NC1"  /> CUBF data is innacurate (manual entry)</span><br/>
                    <div id="NC1" class="desc5 vertical_survey">
                      <div><label><input type="radio" name="Q7_1" value="NC2"> 1 </label></div><br>
                      <div><label><input type="radio" name="Q7_1" value="NC3"> 2 </label></div><br>
                      <div><label><input type="radio" name="Q7_1" value="NC4"> 3+</label></div><br>
                    </div>
                </div>
                <br>

              <p class="text-center"><strong>Q8: Does the building have a rectangular footprint?</strong></p>
              <div class="horizontal" id="Q8">
                <span style="white-space: nowrap; margin-right: 200px;"><input type="radio" name="Q8" value="Yes" /> Yes</span><br>
                <span style="white-space: nowrap;"><input type="radio" name="Q8" value="No"  /> No</span><br>
              </div>
              <br>

              <p class="text-center"><strong>Q9: Are there significant overhangs?</strong></p>
              <div class="horizontal" id="Q9">
                <span style="white-space: nowrap; margin-right: 200px;"><input type="radio" name="Q9" value="Yes" /> Yes</span><br>
                <span style="white-space: nowrap;"><input type="radio" name="Q9" value="No"  /> No</span><br>
              </div>
              <br>

              <p class="text-center"><strong>Q10: Are there many balconies?</strong></p>
              <div class="horizontal" id="Q10">
                <span style="white-space: nowrap; margin-right: 200px;"><input type="radio" name="Q10" value="Yes" /> Yes</span><br>
                <span style="white-space: nowrap;"><input type="radio" name="Q10" value="No"  /> No</span><br>
              </div>
              <br>

              <p class="text-center"><strong>Q11: Are there large, glazed openings or irregular windows and doors?</strong></p>
              <div class="horizontal" id="Q11">
                <span style="white-space: nowrap; margin-right: 200px;"><input type="radio" name="Q11" value="Yes" /> Yes</span><br>
                <span style="white-space: nowrap;"><input type="radio" name="Q11" value="No"  /> No</span><br>
              </div>
              <br>

              <p class="text-center"><strong>Q12: Is there significant mechanical equipment on the roof?</strong></p>
              <div class="horizontal" id="Q12">
                <span style="white-space: nowrap; margin-right: 200px;"><input type="radio" name="Q12" value="Yes" /> Yes</span><br>
                <span style="white-space: nowrap; margin-right: 200px;"><input type="radio" name="Q12" value="No" /> No</span><br>
                <span style="white-space: nowrap;"><input type="radio" name="Q12" value="Unsure"  /> Unsure</span><br>
              </div>
              <br>

              <p class="text-center"><strong>Q13: How simple is the form factor of the building?
                <br> (A simple form factor includes a elements such as a rectangular footprint,
                <br> a lack of balconies, small or insignificant overhangs or eaves, standard windows
                <br> and doors, a small window to wall ratio, a simple roof geometry, etc.) </strong></p>
              <div class="vertical_survey" id="Q13">
                <span style="white-space: nowrap; margin-right: 200px;"><input type="radio" name="Q13" value="1" /> 1 (Very simple form factor) </span><br>
                <span style="white-space: nowrap; margin-right: 200px;"><input type="radio" name="Q13" value="2" /> 2 (Some irregularities)</span><br>
                <span style="white-space: nowrap;"><input type="radio" name="Q13" value="3"  /> 3 (Complex form factor)</span><br>
              </div>

                <div class="btn-row">
                  <input style="display:none;" id="submit_Q13" class="btn btn-vote mr-5" type="submit" value="Submit">
              </div>

              <script>
                $("input[type='radio']").change(function(){
                  if($(this).val()=="3")
                  {
                      $("#submit_Q13").show();
                      $("#submit_Q13_1").hide();

                  }
                  else
                  {
                         $("#submit_Q13").hide();
                         $("#submit_Q13_1").show();
                  }
                  });
              </script>

              <div id = "submit_Q13_1" >
              <div class="text-center">
              <p></p>
              <h5>
                <strong>Section 5: Construction</strong>
              </h5>
            </div>
            <hr />

            <div  class="vertical_survey" id="Q14">
            <p class="text-center"><strong>Q14: What is the structure of the building?</strong></p>
              <span style="white-space: nowrap;"><input type="radio" name="Q14" value="IS1"  /> In situ concrete</span><br/>
              <span style="white-space: nowrap;"><input type="radio" name="Q14" value="LW1"  /> Light wood frame </span><br/>
              <span style="white-space: nowrap;"><input type="radio" name="Q14" value="LB1" /> Load bearing masonry</span><br/>
              <span style="white-space:nowrap;"><input type="radio" name="Q14" value="MT1"  /> Mass timber frame </span><br/>
              <span style="white-space:nowrap;"><input type="radio" name="Q14" value="MS1"  /> Metal structure </span><br/>
                <div id="MS1" class="desc3 vertical_survey">
                  <p class="text-center"><br><strong>What Type of metal structure does the building have?</strong></p>
                  <div><label><input type="radio" name="Q14_2" value="MS2"> Long-Span Framing with trusses </label></div><br>
                  <div><label><input type="radio" name="Q14_2" value="MS3"> Long-Span Framing with girders </label></div><br>
                  <div><label><input type="radio" name="Q14_2" value="MS4"> Multi-story skeleton framing</label></div><br>
                  <div><label><input type="radio" name="Q14_2" value="MS5"> Unsure</label></div><br><br>
                </div>
              <span style="white-space: nowrap;"><input type="radio" name="Q14" value="UN1"  /> Unsure</span><br/>
            </div>
              <br>

              <p class="text-center"><strong>Q15: What type of foundation does the building appear to have?</strong></p>
              <div class="survey" id="Q15">
                <span style="white-space: nowrap;"><input type="radio" name="Q15" value="Basement_foundation" /> Basement foundation </span><br>
                <span style="white-space: nowrap;"><input type="radio" name="Q15" value="Slab-on-grade_foundation"  /> Slab-on-grade foundation</span><br>
                <span style="white-space: nowrap;"><input type="radio" name="Q15" value="Pier_foundation" /> Pier foundation</span><br>
                <span style="white-space: nowrap;"><input type="radio" name="Q15" value="Unsure" /> Unsure</span><br>
              </div>
              <br>

              <br>
              <div class="text-center">
              <p></p>
              <h5>
                <strong>Section 6: Site Context</strong>
              </h5>
            </div>
            <hr />

              <p class="text-center"><strong>Q16: Is the building free-standing?</strong></p>
              <div class="horizontal" id="Q16">
                <span style="white-space: nowrap; margin-right: 200px;"><input type="radio" name="Q16" value="Yes" /> Yes</span><br>
                <span style="white-space: nowrap;"><input type="radio" name="Q16" value="No" /> No</span><br>
              </div>
              <br>

              <p class="text-center"><strong>Q17: Does the building border a parking lot?</strong></p>
              <div class="horizontal" id="Q17">
                <span style="white-space: nowrap; margin-right: 200px;"><input type="radio" name="Q17" value="Yes" /> Yes</span><br>
                <span style="white-space: nowrap;"><input type="radio" name="Q17" value="No" /> No</span><br>
              </div>
              <br>

              <div  class="vertical_survey" id="Q18">
              <p class="text-center"><strong>Q18: Are there obstructions close to the building? (<10m)</strong></p>
                <span style="white-space: nowrap;"><input type="radio" name="Q18" value="N_1" /> No obstruction</span><br/>
                <span style="white-space: nowrap;"><input type="radio" name="Q18" value="YS1"  /> Yes</span><br/>
                  <div id = "YS1" class="desc4">
                    <p class ="text-center"><strong>Obstructions near the building (Select all that apply)?</strong></p>
                    <div class = "survey">
                      <div><label><input type="checkbox" name="Q18_1" value="YS4"> Electrical wires </label></div><br>
                      <div><label><input type="checkbox" name="Q18_1" value="YS3"> Other buildings</label></div><br>
                      <div><label><input type="checkbox" name="Q18_1" value="YS2"> Important trees</label></div><br>
                      <div><label><input type="checkbox" name="Q18_1" value="YS4"> Other objects </label></div><br>
                      <div><label><input type="checkbox" name="Q18_1" value="YS4"> Utility poles </label></div><br>
                    </div>
                    <br>
                  </div>
              </div>

              <!--submit the button and close the form -->
              <div class="btn-row">
                  <input id="btn-submit-vote" class="btn btn-vote mr-5" type="submit" value="Submit">
                </div>

            <br>

            </div>
            </div>
            </div>
            </div>

            </form>
          </div>
        </div>

        <!-- there is nothing in third division, but when you click the button, then satellite image
              will show up, since the first tab completely cover the satellite image if you click it -->
        <div class="tab-pane show active" id="nav-satellite" role="tabpanel" aria-labelledby="nav-satellite-tab"></div>
      </div>

        <div class="map-container">
          <div id="satmap"></div>
        </div>

    </div>
  </div>

  <script src="https://maps.googleapis.com/maps/api/js?key={{key}}&libraries=geometry&callback=initMaps&v=weekly" defer></script>
</section>

{% endblock content %}
