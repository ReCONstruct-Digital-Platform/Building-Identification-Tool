{% extends 'buildings/base.html' %}

{% block content %}
{% load humanize %}

{{ building_latest_view_data | json_script:"building_latest_view_data" }}

<!-- Hack to augment the creation of all WebGL contexts with preserveDrawingBuffer=true -->
<!-- This is done so we can take a screenshot  -->
<!-- https://stackoverflow.com/questions/26783586/canvas-todataurl-returns-blank-image  -->
<script>
  HTMLCanvasElement.prototype.getContext = function(origFn) {
    return function(type, attributes) {
      if (type === 'webgl') {
        attributes = Object.assign({}, attributes, {
          preserveDrawingBuffer: true,
        });
      }
      return origFn.call(this, type, attributes);
    };
  }(HTMLCanvasElement.prototype.getContext);
</script>

<script src="{% static 'scripts/map.js' %}"></script>
<script src="{% static 'scripts/html2canvas.min.js' %}"></script>
<script src="https://maps.googleapis.com/maps/api/js?key={{key}}&libraries=geometry&callback=initMaps&v=weekly" defer></script>

<link rel="stylesheet" type="text/css" href="{% static 'buildings/style.css'%}" media = "print">


<script>
    var map;
    var sv;
    var m_marker;
    var sv_marker;

    var panoRequest;
    var building_coord;


    function initMaps() {
      const svService = new google.maps.StreetViewService();

      // If we have already seen the building, get the latest user defined view
      const building_latest_view_data = JSON.parse(document.getElementById('building_latest_view_data').textContent);

      if (building_latest_view_data) {
        panoRequest = {
          pano: building_latest_view_data['sv_pano']
        };

        building_coord = {
          lat: building_latest_view_data['marker_lat'],
          lng: building_latest_view_data['marker_lng']
        };
      }
      // No previously saved view data
      // we will search for the best panorama
      else {
        building_coord = {
          lat: parseFloat("{{ building.lat }}"),
          lng: parseFloat("{{ building.lon }}")
        };

        panoRequest = {
          location: building_coord,
          preference: google.maps.StreetViewPreference.BEST,
          radius: 50,
          source: google.maps.StreetViewSource.OUTDOOR
        };
      }

      function findPanoramaByRadius(panoRequest, building_coord) {

        console.log(`Searching using radius`);

        svService.getPanorama(panoRequest, function(panoData, status) {
          if (status === google.maps.StreetViewStatus.OK) {

            console.log("Found Panorama")
            // Calculate the correct direction the camera must face
            // based on the panorama default location and the building location
            const heading = google.maps.geometry.spherical.computeHeading(panoData.location.latLng, building_coord);

            sv = new google.maps.StreetViewPanorama(
              document.getElementById('streetview'),
              {
                  position: building_coord,
                  center: building_coord,
                  zoom: 0,
                  pov: {
                    heading: heading,
                    pitch: 0,
                  },
              });

              sv_marker = new google.maps.Marker({
                position: building_coord,
                map: sv,
                title: "Building",
                draggable: true,
              });

              sv_marker.addListener("dragend", ()=> {
                m_marker.setPosition(sv_marker.getPosition());
              })

              // Setting the panorama after the marker has been defined,
              // otherwise the marker does not show for some reason!
              // https://stackoverflow.com/questions/23498921/google-street-view-with-custom-panorama-and-markers
              sv.setPano(panoData.location.pano);
              window.sv = sv;

              map = new google.maps.Map(document.getElementById("satmap"), {
                center: building_coord,
                mapTypeId: 'satellite',
                zoom: 18,
                // streetViewControl: false,
                rotateControl: false,
                controlSize: 25,
              });

              m_marker = new google.maps.Marker({
                position: building_coord,
                map: map,
                draggable: true,
              });

              map.setStreetView(sv);
              window.map = map;

              // Listen to the marker being dragged and update the one on the streetview to match
              m_marker.addListener("dragend", ()=> {
                sv_marker.setPosition(m_marker.getPosition());
              })
          }
          else {
            var radius = panoRequest.radius
            //Handle other statuses here
            if (radius > 200) {
              console.log(`Could not find a street view within ${radius}m of building! Giving up.`);
              elem = document.createElement('div');
              elem.innerText = "Could not find Panorama for location";
              document.getElementById("streetview").appendChild(elem);
              return False;
            }
            else {
              console.log(`Could not find street view within ${radius}m, trying again within ${radius+50}m.`)
              panoRequest.radius = panoRequest.radius + 50;
              findPanoramaByRadius(panoRequest, building_coord);
            }
          }
        });
        }

      function findPanoramaById(panoRequest, building_coord) {
        console.log(`Searching for panorama using Id: ${panoRequest.pano}`);

        svService.getPanorama(panoRequest, function(panoData, status) {
          if (status === google.maps.StreetViewStatus.OK) {

            const heading = building_latest_view_data['sv_heading'];
            const zoom = building_latest_view_data['sv_zoom'];
            const pitch = building_latest_view_data['sv_pitch'];

            sv = new google.maps.StreetViewPanorama(
              document.getElementById('streetview'),
              {
                  position: building_coord,
                  center: building_coord,
                  zoom: zoom,
                  pov: {
                    heading: heading,
                    pitch: pitch,
                  },
              });

              sv_marker = new google.maps.Marker({
                position: building_coord,
                map: sv,
                title: "Building",
                draggable: true,
              });

              sv_marker.addListener("dragend", ()=> {
                m_marker.setPosition(sv_marker.getPosition());
              })

              // Setting the panorama after the marker has been defined,
              // otherwise the marker does not show for some reason!
              // https://stackoverflow.com/questions/23498921/google-street-view-with-custom-panorama-and-markers
              sv.setPano(panoData.location.pano);
              window.sv = sv;

              map = new google.maps.Map(document.getElementById("satmap"), {
                center: building_coord,
                mapTypeId: 'satellite',
                zoom: 18,
                streetviewControl: false,
                rotateControl: false,
                controlSize: 25,
              });

              m_marker = new google.maps.Marker({
                position: building_coord,
                map: map,
                draggable: true,
              });

              map.setStreetView(sv);
              window.map = map;

              // Listen to the marker being dragged and update the one on the streetview to match
              m_marker.addListener("dragend", ()=> {
                sv_marker.setPosition(m_marker.getPosition());
              })
          }
          else {
            console.log(`Could not find panorama id ${panoRequest.pano}. Searching using radius`);
            // Making a radius search request
            panoRequest = {
              location: building_coord,
              preference: google.maps.StreetViewPreference.BEST,
              radius: 50,
              source: google.maps.StreetViewSource.OUTDOOR
            };
            return findPanoramaByRadius(panoRequest, building_coord);
          }
        });
      }

      if (building_latest_view_data)
        findPanoramaById(panoRequest, building_coord);
        else
        findPanoramaByRadius(panoRequest, building_coord);
    }

    window.initMaps = initMaps;
</script>

<section class="container-wide mb-3">
  <div class="classify-top-row">
    <div class="building-nav building-nav-left">
      <a id="prev-building-link">&laquo;&laquo; Prev</a>
    </div>
    <div class="building-info">

      <div class="building-info-col">
        <div class="building-id">
          <h4>
            Building #{{ building.id }}
          </h4>
        </div>
        <div>
          {{ building.formatted_address }}
        </div>
        <div class="building-cubf">
          CUBF {{ building.cubf }}: {{ building.cubf_name }}
        </div>
      </div>
      <div class="building-info-col ms-5">
        <div>
          Const. year:
          {% if building.construction_year != 9999 %}
            {{ building.construction_year }}
            {% if building.year_real_esti == 'E' %}
            (est.)
            {% endif %}
          {% else %}
          &mdash;
          {% endif %}
        </div>
        <div>
          Max floors:
          {% if building.max_num_floor %}
          {{ building.max_num_floor }}
          {% else %}
          &mdash;
          {% endif %}
        </div>
        <div>
          Num dwellings:
          {% if building.num_dwell %}
            {{ building.num_dwell }}
          {% else %}
          &mdash;
          {% endif %}
        </div>
      </div>

      <div class="building-info-col ms-5">
        <div>
          Type const.:
          {% if building.type_const %}

          {% include "buildings/utils/construction_type.html" with type_const=building.type_const %}

          {% else %}
          &mdash;
          {% endif %}
        </div>
        <div>
          Property value: ${{ building.value_prop|intcomma }}
        </div>

        <div>
          Floor area:
          {% if building.floor_area != 9999.0 %}
          {{ building.floor_area|intcomma }} m<sup>2</sup>
          {% else %}
          &mdash;
          {% endif %}
        </div>
      </div>
      <button id="btn-no-building" type="button" class="btn btn-danger btn-no-building ms-5">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 2 16 17" fill="currentColor" class="bi bi-exclamation-triangle-fill">
          <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
        </svg>
        No Building
      </button>
      <button id="btn-screenshot" type="button" class="btn btn-primary btn-screenshot ms-3">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 32 32" fill="#ffffff" preserveAspectRatio="xMidYMid">
          <path d="M29.000,26.000 L3.000,26.000 C1.346,26.000 -0.000,24.654 -0.000,23.000 L-0.000,7.000 C-0.000,5.346 1.346,4.000 3.000,4.000 L7.381,4.000 L9.102,0.554 C9.270,0.214 9.617,0.000 9.996,0.000 L22.006,0.000 C22.385,0.000 22.731,0.214 22.901,0.554 L24.619,4.000 L29.000,4.000 C30.654,4.000 32.000,5.346 32.000,7.000 L32.000,23.000 C32.000,24.654 30.654,26.000 29.000,26.000 ZM30.000,7.000 C30.000,6.449 29.551,6.000 29.000,6.000 L24.000,6.000 C23.950,6.000 23.907,5.979 23.859,5.972 C23.788,5.961 23.717,5.955 23.649,5.929 C23.588,5.906 23.537,5.869 23.482,5.834 C23.428,5.801 23.373,5.773 23.326,5.729 C23.273,5.680 23.235,5.620 23.194,5.560 C23.166,5.520 23.127,5.491 23.105,5.446 L21.387,2.000 L10.615,2.000 L8.895,5.446 C8.848,5.541 8.785,5.623 8.715,5.695 C8.701,5.710 8.684,5.719 8.669,5.733 C8.597,5.798 8.518,5.851 8.432,5.892 C8.403,5.907 8.375,5.919 8.344,5.931 C8.234,5.971 8.120,5.999 8.002,6.000 C8.001,6.000 8.001,6.000 8.000,6.000 L3.000,6.000 C2.449,6.000 2.000,6.449 2.000,7.000 L2.000,23.000 C2.000,23.551 2.449,24.000 3.000,24.000 L29.000,24.000 C29.551,24.000 30.000,23.551 30.000,23.000 L30.000,7.000 ZM16.000,21.000 C12.140,21.000 9.000,17.860 9.000,14.000 C9.000,10.140 12.140,7.000 16.000,7.000 C19.860,7.000 23.000,10.140 23.000,14.000 C23.000,17.860 19.860,21.000 16.000,21.000 ZM16.000,9.000 C13.243,9.000 11.000,11.243 11.000,14.000 C11.000,16.757 13.243,19.000 16.000,19.000 C18.757,19.000 21.000,16.757 21.000,14.000 C21.000,11.243 18.757,9.000 16.000,9.000 Z"/>
      </svg>
        Screenshot
      </button>
    </div>
    <div class="building-nav building-nav-right">
      <a id="next" href="{% url 'buildings:classify' next_building %}">Next &raquo;&raquo;</a>
    </div>
  </div>
</section>

<section class="container-wide">
  <!--overall container-->
  <div class="streetview-and-map-container" >
    <div class="streetview-container ms-3">
      <div id="streetview"></div>
    </div>
    <div id="dragbar"></div>

    <!--min width here style = 'min-width: 42%"-->
    <div class="map-and-submit-container me-3"  style = 'min-width: 42%' >

      <!--navigation bar-->
      <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
          <button id="nav-satellite-tab" class="nav-link active" data-bs-toggle="tab" data-bs-target="#nav-satellite" type="button" role="tab" aria-controls="nav-satellite" aria-selected="true" >Satellite</button>
          <button id="nav-survey-tab" class="nav-link" data-bs-toggle="tab" data-bs-target="#nav-survey" type="button" role="tab" aria-controls="nav-survey" aria-selected="false">Survey</button>
        </div>
      </nav>

      <div id="satmap"></div>

      <!--division: division of satellite image and survey questionnaires -->
      <div class="tab-content" id="nav-tabContent">
        <!-- Satellite view -->
        <div id="nav-satellite" class="tab-pane active" role="tabpanel" aria-labelledby="nav-satellite-tab">
        </div>

        <!-- Survey -->
        <div id="nav-survey" class="tab-pane" role="tabpanel" aria-labelledby="nav-survey-tab">

          <!--below is the first scrolling survey -->
          <div id="scroll">
            <div class="text-center pt-2">
              <h5>
                <strong>Building Identification Survey Round 1 </strong>
              </h5>
            </div>
            <hr />

            <form id="building-submission-form" action="{% url 'buildings:classify' building.id %}" method="post">
              <!-- Necessary for security -->
              {% csrf_token %}

              <!-- Q1 -->
              <!-- I changed this one to have a container for the header and choices, and to use <fieldset> tags around it -->
              <fieldset class="q-container ps-5 pb-3">
                <legend class="q-header pb-1 ">
                  <strong>Q1: Does the building have a simple footprint?</strong>
                </legend>
                <div class="survey-3col" id="Q1">
                  <label for ="Y1"><input class="me-1" type="radio" name="Q1" value="yes" id = "Y1" required />Yes</label>
                  <label for ="N1"><input class="me-1" type="radio" name="Q1" value="no" id = "N1" required />No</label>
                 </div>
              </fieldset>

              <!-- Q2 -->
              <fieldset class="q-container ps-5 pb-3">
                <legend class="q-header pb-1">
                  <strong>Q2: Does the building have a simple volumetric form?</strong>
                </legend>
                <div class="survey-3col" id="Q2">
                  <label for="Y2"><input class="me-1" type="radio" name="Q2" value="yes" id="Y2" required/>Yes</label>
                  <label for="N2"><input class="me-1" type="radio" name="Q2" value="no" id="N2" required/>No</label>
                 </div>
              </fieldset>

             <!-- Q3 -->
             <fieldset class="q-container ps-5 pb-3">
              <legend class="q-header pb-1">
                <strong>Q3: How many storeys above-ground does the building have?</strong>
              </legend>
               <div class="survey-3col" id="Q3">
                 <div class = "specify">
                   <label for="Q3_1" class = "me-1">
                    <input type="radio" name = "Q3" class = "me-1 specify" id = "Q3_1" required>Number of storeys = </label>
                    <input class = "me-1" type="number" id="I3" name="Q3" min="0" disabled/>
                 </div>
                 <label for="U3"><input class="me-1" type="radio" name="Q3" value="unsure" id="U3" required/>Unsure</label>
               </div>
             </fieldset>

              <!-- Q4 -->
              <fieldset class="q-container ps-5 pb-3">
              <legend class="q-header pb-1">
                <strong>Q4: Does the building have a basement?</strong>
              </legend>
              <div class="survey-3col" id="Q4">
                <label for="Y4"><input class="me-1" type="radio" name="Q4" value="yes" id="Y4" required/>Yes</label>
                <label for="N4"><input class="me-1" type="radio" name="Q4" value="no" id="N4" required/>No</label>
                <label for="U4"><input class="me-1" type="radio" name="Q4" value="unsure" id="U4" required/>Unsure</label>
              </div>
             </fieldset>

            <!-- Q5 -->
            <fieldset class="q-container ps-5 pb-3">
              <legend class="q-header pb-1">
                <strong>Q5: Are there obstructions to machine access around the building (within 3m or less)? Select all that apply.</strong>
              </legend>
              <div id="Q5">
              <label for="Q5_1"><input class="me-1" type="checkbox" name="Q5" value="Important_trees_or_landscaping" id="Q5_1" onclick='deRequire("Q5")' required/>Important trees or landscaping</label><br>
              <label for="Q5_2"><input class="me-1" type="checkbox" name="Q5" value="Buildings" id="Q5_2" onclick='deRequire("Q5")' required/>Buildings</label><br>
              <label for="Q5_3"><input class="me-1" type="checkbox" name="Q5" value="Overhead_wires" id="Q5_3" onclick='deRequire("Q5")' required/>Overhead wires, including those blocking general access to site</label><br>
              <label for="Q5_4"><input class="me-1" type="checkbox" name="Q5" value="Overhead_wires" id="Q5_4" onclick='deRequire("Q5")' required/>No significant obstructions</label><br>
              <div class = "specify">
                <label for="Q5_51" class = "me-1"><input type="checkbox" class = "me-1" name="Q5" id = "Q5_51" onclick='deRequire("Q5")' required>Other (specify): </label>
                <input type = "text" id="Q5_5" name="Q5_5_value" disabled />
              </div>
              </div>
            </fieldset>

            <!-- Q6 -->
            <fieldset class="q-container ps-5 pb-3">
              <legend class="q-header pb-1">
                <strong>Q6: Are there significant appendages to the building faces? Select all that apply.</strong>
              </legend>
              <div id="Q6">
                <label for="Q6_1"><input class="me-1" type="checkbox" name="Q6" value="Canopies" id="Q6_1" onclick='deRequire("Q6")' required/>Canopies/overhangs/eaves</label><br>
                <label for="Q6_2"><input class="me-1" type="checkbox" name="Q6" value="Balconies" id="Q6_2" onclick='deRequire("Q6")' required/>Balconies</label><br>
                <label for="Q6_3"><input class="me-1" type="checkbox" name="Q6" value="Porches/stoops" id="Q6_3" onclick='deRequire("Q6")' required/>Porches/stoops</label><br>
                <label for="Q6_4"><input class="me-1" type="checkbox" name="Q6" value="Vestibules" id="Q6_4" onclick='deRequire("Q6")' required/>Vestibules</label><br>
                <label for="Q6_5"><input class="me-1" type="checkbox" name="Q6" value="No_significant_appendages" id="Q6_5" onclick='deRequire("Q6")' required/>No significant appendages</label><br>

              <div class = "specify">
                <label for="Q6_61" class = "me-1"><input type="checkbox" class = "me-1" name="Q6" id = "Q6_61" onclick='deRequire("Q6")' required>Other (specify): </label>
                <input type = "text" id="Q6_6" name="Q6_6_value" disabled />
              </div>
              </div>
            </fieldset>

            <!-- Q7 -->
            <fieldset class="q-container ps-5 pb-3">
              <legend class="q-header pb-1">
                <strong>Q7: What type of exterior cladding does the building appear to have? Select all that apply.</strong>
              </legend>
              <div class="survey-3col" id="Q7">
                <label for="Q7_1"><input class="me-1" type="checkbox" name="Q7" value="Concrete" id="Q7_1" onclick='deRequire("Q7")' required/>Concrete</label>
                <label for="Q7_2"><input class="me-1" type="checkbox" name="Q7" value="Plaster" id="Q7_2" onclick='deRequire("Q7")' required/>Plaster</label>
                <label for="Q7_3"><input class="me-1" type="checkbox" name="Q7" value="Wood" id="Q7_3" onclick='deRequire("Q7")' required/>Wood</label>
                <label for="Q7_4"><input class="me-1" type="checkbox" name="Q7" value="Vinyl" id="Q7_4" onclick='deRequire("Q7")' required/>Vinyl</label>
                <label for="Q7_5"><input class="me-1" type="checkbox" name="Q7" value="Curtain_Wall" id="Q7_5" onclick='deRequire("Q7")' required/>Curtain Wall</label>
                <label for="Q7_6"><input class="me-1" type="checkbox" name="Q7" value="Metal" id="Q7_6" onclick='deRequire("Q7")' required/>Metal</label>
                <label for="Q7_7"><input class="me-1" type="checkbox" name="Q7" value="Brick_masonry" id="Q7_7" onclick='deRequire("Q7")' required/>Brick masonry</label>
                <label for="Q7_8"><input class="me-1" type="checkbox" name="Q7" value="Stone_masonry" id="Q7_8" onclick='deRequire("Q7")' required/>Stone masonry</label>
                <label for="Q7_9"><input class="me-1" type="checkbox" name="Q7" value="Unsure" id="Q7_9" onclick='deRequire("Q7")' required/>Unsure</label>

              <div class = "specify">
                <label for="Q7_101" class = "me-1"><input type="checkbox" class = "me-1" name="Q7" id = "Q7_101" onclick='deRequire("Q7")' required>Other (specify): </label>
                <input type = "text" id="Q7_10" name="Q7_10_value" disabled />
              </div>
              </div>
            </fieldset>

            <!-- Q8 -->
            <fieldset class="q-container ps-5 pb-3">
            <legend class="q-header pb-1">
              <strong>Q8: How would you describe the condition of the exterior façades?</strong>
            </legend>
            <div class="survey-2col" id="Q8">
              <label for="G8"><input class="me-1" type="radio" name="Q8" value="good" id="G8" required/>Good</label>
              <label for="F8"><input class="me-1" type="radio" name="Q8" value="fair" id="F8" required/>Fair</label>
              <label for="P8"><input class="me-1" type="radio" name="Q8" value="poor" id="P8" required/>Poor</label>
              <label for="U8"><input class="me-1" type="radio" name="Q8" value="unsure" id="U8" required/>Unsure</label>
            </div>
           </fieldset>

            <!-- Q9 -->
            <fieldset class="q-container ps-5 pb-3">
            <legend class="q-header pb-1">
              <strong>Q9: Is there a large proportion of windows to overall façade area?</strong>
            </legend>
            <div class="survey-2col" id="Q9">
              <label for="L9"><input class="me-1" type="radio" name="Q9" value="large" id="L9" required/>Large</label>
              <label for="M9"><input class="me-1" type="radio" name="Q9" value="medium" id="M9" required/>Medium</label>
              <label for="S9"><input class="me-1" type="radio" name="Q9" value="small" id="S9" required/>Small</label>
              <label for="U9"><input class="me-1" type="radio" name="Q9" value="unsure" id="U9" required/>Unsure</label>
            </div>
            </fieldset>

          <!-- Q10 -->
          <fieldset class="q-container ps-5 pb-3">
          <legend class="q-header pb-1">
            <strong>Q10: Are there very large and/or irregularly shaped windows? </strong>
          </legend>
          <div class="survey-3col" id="Q10">
            <label for="Y10"><input class="me-1" type="radio" name="Q10" value="yes" id="Y10" required/>Yes</label>
            <label for="N10"><input class="me-1" type="radio" name="Q10" value="no" id="N10" required/>No</label>
            <label for="U10"><input class="me-1" type="radio" name="Q10" value="unsure" id="U10" required/>Unsure</label>
          </div>
          </fieldset>

          <!-- Q11 -->
          <fieldset class="q-container ps-5 pb-3">
            <legend class="q-header pb-1">
              <strong>Q11: What best describes the roof geometry?</strong>
            </legend>
            <div class="survey-3col" id="Q11">
              <label for="Q11_1"><input class="me-1" type="checkbox" name="Q11" value="Flat" id="Q11_1" onclick='deRequire("Q11")' required/>Flat</label>
              <label for="Q11_2"><input class="me-1" type="checkbox" name="Q11" value="Pitched" id="Q11_2" onclick='deRequire("Q11")' required/>Pitched</label>
              <label for="Q11_3"><input class="me-1" type="checkbox" name="Q11" value="Curved" id="Q11_3" onclick='deRequire("Q11")' required/>Curved</label>
              <label for="Q11_4"><input class="me-1" type="checkbox" name="Q11" value="Complex" id="Q11_4" onclick='deRequire("Q11")' required/>Complex</label>
              <label for="Q11_5"><input class="me-1" type="checkbox" name="Q11" value="U11" id="Q11_5" onclick='deRequire("Q11")' required/>Unsure</label>

            <div class = "specify">
              <label for="Q11_61" class = "me-1"><input type="checkbox" class = "me-1" name="Q11" id = "Q11_61" onclick='deRequire("Q11")' required>Other (specify): </label>
              <input type = "text" id="Q11_6" name="Q11_6_value" disabled />
            </div>
            </div>
          </fieldset>

          <!-- Q12 -->
          <fieldset class="q-container ps-5 pb-3">
            <legend class="q-header pb-1">
              <strong>Q12: What type of structure does the building appear to have?</strong>
            </legend>
            <div id="Q12">
              <label for="Q12_1"><input class="me-1" type="checkbox" name="Q12" value="Wood_frame_or_light_gauge_steel" id="Q12_1" onclick='deRequire("Q12")' required/>Wood frame or light gauge steel</label><br>
              <label for="Q12_2"><input class="me-1" type="checkbox" name="Q12" value="Load-bearing_brick_masonry" id="Q12_2" onclick='deRequire("Q12")' required/>Load-bearing brick masonry</label><br>
              <label for="Q12_3"><input class="me-1" type="checkbox" name="Q12" value="Load-bearing_stone_masonry" id="Q12_3" onclick='deRequire("Q12")' required/>Load-bearing stone masonry</label><br>
              <label for="Q12_4"><input class="me-1" type="checkbox" name="Q12" value="Concrete_frame" id="Q12_4" onclick='deRequire("Q12")' required/>Concrete frame</label><br>
              <label for="Q12_5"><input class="me-1" type="checkbox" name="Q12" value="Steel_frame" id="Q12_5" onclick='deRequire("Q12")' required/>Steel frame</label><br>
              <label for="Q12_6"><input class="me-1" type="checkbox" name="Q12" value="U12" id="Q12_6" onclick='deRequire("Q12")' required/>Unsure</label><br>

            <div class = "specify">
              <label for="Q12_71" class = "me-1"><input type="checkbox" class = "me-1" name="Q12" id = "Q12_71" onclick='deRequire("Q12")' required>Other (specify): </label>
              <input type = "text" id="Q12_7" name="Q12_7_value" disabled />
            </div>
            </div>
          </fieldset>

          <!-- Q13 -->
          <fieldset class="q-container ps-5 pb-3" id="Q13">
          <legend class="q-header pb-1">
            <strong>Q13: Does this building look new and/or recently renovated?</strong>
          </legend>
          <div class="survey-3col">
            <label for="Y13"><input class="me-1" type="radio" name="Q13" value="yes" id="Y13" required />Yes</label>
            <label for="N13"><input class="me-1" type="radio" name="Q13" value="no" id="N13" required/>No</label>
            <label for="U13"><input class="me-1" type="radio" name="Q13" value="unsure" id="U13" required/>Unsure</label>
          </div>
          </fieldset>
          {% if  building.construction_year != None %}
             <script>
                document.getElementById("Q13").style.display = "none";
                document.getElementById("Y13").required = false;
                document.getElementById("N13").required = false;
                document.getElementById("U13").required = false;
             </script>
          {% endif %}

            <!--submit the button and close the form -->
            <div class="btn-row">
                <input id="btn-submit-vote" class="btn btn-vote me-5" type="submit" value="Submit">
            </div>
            <br>

          </form>

        </div>

      </div>

    </div>
  </div>

</section>

<input type="hidden" id="upload_url" data-url="{% url 'buildings:upload_imgs' building.id %}" />


{% endblock content %}
